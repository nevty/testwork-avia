(this["webpackJsonptestwork-avia"]=this["webpackJsonptestwork-avia"]||[]).push([[0],{37:function(e,t,a){e.exports=a.p+"static/media/error_face.bc5f6531.svg"},38:function(e,t,a){e.exports=a.p+"static/media/loading.dd6c5e8f.svg"},43:function(e,t,a){e.exports=a(76)},48:function(e,t,a){},50:function(e,t,a){},76:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(17),s=a.n(c),i=(a(48),a(49),a(50),a(12)),l=a(13),o=a(15),u=a(14),m=a(16),d=a(9),f=a(22),p=a.n(f),h=a(11),E=a(35),_=a.n(E).a.create({baseURL:"https://front-test.beta.aviasales.ru"}),v=function(){return _.get("/search")},g=function(e){return _.get("/tickets?searchId=".concat(e))},b={tickets:[],searchId:"",filteredByStops:"",sorted:null,stop:!1,maxSize:10,ticketsErrorResponse:null,isFetching:!1},k=function(e){return{type:"SET_TICKETS",tickets:e}},S=function(e){return{type:"SET_TICKETS_FETCHING",boolean:e}},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TICKETS":return Object(h.a)({},e,{tickets:t.tickets});case"SET_TICKETS_ERROR_RESPONSE":return Object(h.a)({},e,{ticketsErrorResponse:t.error});case"SET_TICKETS_FETCHING":return Object(h.a)({},e,{isFetching:t.boolean});case"SET_SEARCH_ID":return Object(h.a)({},e,{searchId:t.id});case"SORT_TICKETS_BY_PRICE":return Object(h.a)({},e,{sorted:"cheap",tickets:e.tickets.sort((function(e,t){return e.price-t.price}))});case"SORT_TICKETS_BY_DURATION":return Object(h.a)({},e,{sorted:"fast",tickets:e.tickets.sort((function(e,t){return e.segments[0].duration-t.segments[0].duration}))});case"SET_FILTER_TICKETS_BY_STOPS":return Object(h.a)({},e,{filteredByStops:t.number});default:return e}},y=a(78),O=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(o.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).handleChange=function(e){var t=e.target;a.props.setFilterTicketsByStops(t.value)},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("aside",{className:"Tickets__filter text-left p-4 mt-2 shadow-sm bg-white rounded"},r.a.createElement("h5",null,"\u041a\u041e\u041b\u0418\u0427\u0415\u0421\u0422\u0412\u041e \u041f\u0415\u0420\u0415\u0421\u0410\u0414\u041e\u041a"),[{value:"",label:"\u0412\u0441\u0435"},{value:0,label:"\u0411\u0435\u0437 \u043f\u0435\u0440\u0441\u0430\u0434\u043e\u043a"},{value:1,label:"1 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0430"},{value:2,label:"2 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0438"},{value:3,label:"3 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0438"}].map((function(t){return r.a.createElement("div",{key:t.value},r.a.createElement(y.a.Check,{custom:!0,type:"radio",name:"stops",id:"custom-radio-".concat(t.value),value:t.value,label:t.label,onChange:e.handleChange}))})))}}]),t}(r.a.Component),N=Object(d.b)((function(e){return{filteredByStops:e.ticketsPage.filteredByStops}}),(function(e){return{setFilterTicketsByStops:function(t){e(function(e){return{type:"SET_FILTER_TICKETS_BY_STOPS",number:e}}(t))}}}))(O),x=a(80),w=a(42),j=a(41),R=a(79),I=a(77);function C(e,t){var a=Math.floor(e/60),n=e%60;return"dotted"===t?B(a,n):"hm"===t?"".concat(a,"\u0447 ").concat(n,"\u043c"):"".concat(a,"h ").concat(n,"m")}function B(e,t){return t=t<10?"0"+t:t,"".concat(e=e<10?"0"+e:e,":").concat(t)}function P(e,t){var a=new Date(e.getTime()+6e4*t);return B(a.getHours(),a.getMinutes())}var F=function(e){var t=e.tickets;if(""!==e.filteredByStops&&t.length){var a=+e.filteredByStops;t=Object(j.a)(e.tickets.filter((function(e){return e.segments[0].stops.length===a&&e.segments[1].stops.length===a})))}var n=t.slice(0,e.offset).map((function(e,t){var a=e.segments[0].origin,n=e.segments[1].destination,c=e.segments[0].stops,s=e.segments[1].stops,i=c.join(", "),l=s.join(", "),o=e.segments[0].duration,u=e.segments[1].duration,m=new Date(e.segments[0].date),d=new Date(e.segments[1].date),f=B(m.getHours(),m.getMinutes()),p=B(d.getHours(),d.getMinutes()),h=P(m,o),E=P(d,u);return r.a.createElement(R.a,{key:t,className:"mt-4 p-4 shadow-sm"},r.a.createElement("div",{className:"ticket__container"},r.a.createElement("div",{className:"ticket__head row"},r.a.createElement("h3",{className:"ticket__price col-6 text-left text-primary"},e.price,r.a.createElement("span",{className:"price__currency"}," \u0420")),r.a.createElement("div",{className:"ticket__ship-info col-6 text-right"},r.a.createElement(I.a,{src:"http://pics.avs.io/99/36/".concat(e.carrier,".png"),className:"",alt:e.carrier}))),r.a.createElement("div",{className:"ticket__table"},r.a.createElement("div",{className:"ticket__to row"},r.a.createElement("div",{className:"table__tr col text-left"},r.a.createElement("div",{className:"ticket__headline text-secondary text-grey"},a," - ",n),r.a.createElement("div",{className:"table__td"},f," - ",h)),r.a.createElement("div",{className:"table__tr col"},r.a.createElement("div",{className:"ticket__headline text-secondary text-grey"},"\u0412 \u043f\u0443\u0442\u0438"),r.a.createElement("div",{className:"table__td"},C(o,"hm"))),r.a.createElement("div",{className:"table__tr col text-right"},r.a.createElement("div",{className:"ticket__headline text-secondary text-grey"},"\u041f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0438: ",c.length?c.length:""),r.a.createElement("div",{className:"table__td"},c.length?i:"\u0411\u0435\u0437 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043e\u043a"))),r.a.createElement("div",{className:"ticket__back row"},r.a.createElement("div",{className:"table__tr col text-left"},r.a.createElement("div",{className:"ticket__headline text-secondary text-grey"},n," - ",a),r.a.createElement("div",{className:"table__td"},p," - ",E)),r.a.createElement("div",{className:"table__tr col"},r.a.createElement("div",{className:"ticket__headline text-secondary text-grey"},"\u0412 \u043f\u0443\u0442\u0438"),r.a.createElement("div",{className:"table__td"},C(u,"hm"))),r.a.createElement("div",{className:"table__tr col text-right"},r.a.createElement("div",{className:"ticket__headline text-secondary text-grey"},"\u041f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0438: ",s.length?s.length:""),r.a.createElement("div",{className:"table__td"},s.length?l:"\u0411\u0435\u0437 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043e\u043a"))))))}));return r.a.createElement(r.a.Fragment,null,n)},K=a(10),D=a(37),H=a.n(D),z=function(e){return{ticketsErrorResponse:e.ticketsPage.ticketsErrorResponse}},A=a(38),Y=a.n(A),M=function(e){return r.a.createElement("div",{className:"mt-4 mb-4 bg-white"},r.a.createElement("img",{src:Y.a,width:"70",alt:""}))};var L=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).handleScroll=function(e){var t=a.main.current;t.scrollHeight+t.offsetTop-(window.innerHeight+window.pageYOffset)===0&&a.setState((function(e){return{ticketsOffest:e.ticketsOffest+a.props.maxSize}}))},a.handleSort=function(e){var t=e.target;a.props.sorted!==t.value&&("cheap"===t.value&&a.props.sortTicketsByPrice(),"fast"===t.value&&a.props.sortTicketsByDuration())},a.state={ticketsOffest:a.props.maxSize},a.main=r.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.getTicketsRequest(),window.addEventListener("scroll",function(e,t){var a=!0,n=null,r=null;return function c(){for(var s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];if(!a)return n=i,void(r=this);e.apply(this,i),a=!1,r=null,n=null,setTimeout((function(){a=!0,n&&c.apply(r,n)}),t)}}(this.handleScroll,40))}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(x.a,{type:"radio",name:"sort",className:"shadow-sm w-100"},r.a.createElement(w.a,{variant:"light",value:"cheap",onChange:this.handleSort},"\u0421\u0430\u043c\u044b\u0439 \u0434\u0435\u0448\u0451\u0432\u044b\u0439"),r.a.createElement(w.a,{variant:"light",value:"fast",onChange:this.handleSort},"\u0421\u0430\u043c\u044b\u0439 \u0431\u044b\u0441\u0442\u0440\u044b\u0439")),r.a.createElement("div",{className:"Tickets__list",ref:this.main},r.a.createElement(F,{tickets:this.props.tickets,offset:this.state.ticketsOffest,filteredByStops:this.props.filteredByStops,maxSize:this.props.maxSize}),this.props.isFetching?r.a.createElement(M,null):null))}}]),t}(r.a.Component),U=Object(K.d)(Object(d.b)((function(e){return{tickets:e.ticketsPage.tickets,filteredByStops:e.ticketsPage.filteredByStops,sorted:e.ticketsPage.sorted,maxSize:e.ticketsPage.maxSize,isFetching:e.ticketsPage.isFetching}}),(function(e){return{getTicketsRequest:function(){e((function(e){v().then((function(t){return e({type:"SET_SEARCH_ID",id:t.data.searchId}),t.data.searchId})).then((function(t){e(S(!0));var a=[];!function(t){var n,r,c;p.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:n=0,r=0,c=!1;case 3:if(!(n<50&&!c&&r<50)){s.next=8;break}return s.next=6,p.a.awrap(g(t).then((function(e){a.push(e.data.tickets.flat()),c=e.data.stop,n++}),(function(e){return r++})));case 6:s.next=3;break;case 8:e(k(a.flat())),e(S(!1));case 10:case"end":return s.stop()}}))}(t)}),(function(t){e(S(!1)),e(function(e){return{type:"SET_TICKETS_ERROR_RESPONSE",error:e}}(t.response.status))}))}))},sortTicketsByPrice:function(){e({type:"SORT_TICKETS_BY_PRICE"})},sortTicketsByDuration:function(){e({type:"SORT_TICKETS_BY_DURATION"})}}})),(function(e){var t=function(t){function a(){return Object(i.a)(this,a),Object(o.a)(this,Object(u.a)(a).apply(this,arguments))}return Object(m.a)(a,t),Object(l.a)(a,[{key:"render",value:function(){return null!==this.props.ticketsErrorResponse?r.a.createElement("div",{className:"fallback vh-100 bg-white"},r.a.createElement("div",{className:"fallback__message"},r.a.createElement("img",{src:H.a,width:"60",alt:""}),r.a.createElement("h4",null,"Something went wrong,",r.a.createElement("br",null),"Try refresh the page"))):r.a.createElement(e,this.props)}}]),a}(r.a.Component);return Object(d.b)(z)(t)}))(L);var q=function(){return r.a.createElement("div",{className:"App container-fluid"},r.a.createElement("div",{className:"row limit"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement(N,null)),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement(U,null))))},G=a(39),J=Object(K.c)({ticketsPage:T}),Q=Object(K.e)(J,Object(K.a)(G.a));s.a.render(r.a.createElement(d.a,{store:Q},r.a.createElement(q,null)),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.9281cc50.chunk.js.map